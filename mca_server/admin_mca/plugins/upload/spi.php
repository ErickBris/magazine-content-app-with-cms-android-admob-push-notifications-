<?php require_once('../../invedion_connect.php');$img_info["destination_folder"]='../../../images/';$img_info["quality"]=90;$img_info["random_file_name"]=true;if(isset($_POST)&&isset($_SERVER['HTTP_X_REQUESTED_WITH'])&&strtolower($_SERVER['HTTP_X_REQUESTED_WITH'])=='xmlhttprequest'){if(!isset($_FILES['image_file'])||!is_uploaded_file($_FILES['image_file']['tmp_name'])){die('Image file is Missing!');}$fid=addslashes(strip_tags(trim($_POST['fid'])));$id=addslashes(strip_tags(trim($_POST['id'])));$gc=addslashes(strip_tags(trim($_POST['gc'])));$idlng=addslashes(strip_tags(trim($_POST['idlng'])));$pg=addslashes(strip_tags(trim($_POST['page'])));$img_info["image_data"]=$_FILES['image_file'];$img_info["unique_id"]=$fid.'_'.uniqid();if(!file_exists($img_info["destination_folder"])){die($img_info["destination_folder"]." - (Folder doesn't exist!)");}$im_info=getimagesize($img_info["image_data"]["tmp_name"]);if($im_info){$img_info["image_width"]=$im_info[0];$img_info["image_height"]=$im_info[1];$img_info["image_type"]=$im_info['mime'];}else{die("Make sure image file is valid!");}$img_info["img_res"]=get_image_resource($img_info);if($img_info["img_res"]){$resize_image=resize_image($img_info);if($resize_image){$cn=idbc();$qf=$cn->query("UPDATE mca_content SET photo = '$resize_image' WHERE id = '$fid'");if($qf){?> <div class="foto_ntaa_bg"> <a rel="example_group" href="../images/<?php echo $resize_image;?>" class="foto"><img src="../images/<?php echo $resize_image;?>" width="49" height="70" /></a> <a href="index.php?id=<?php echo $id;?>&pid=<?php echo $fid;?><?php if($gc){?>&gc=<?php echo $gc;}?><?php if($idlng){?>&idlng=<?php echo $idlng;}?><?php if($pg){?>&page=<?php echo $pg;}?>" class="nta_del"><img src="images/delete.png" width="12" height="12"></a> </div> <?php }}}else{die("Error creating image resource!");}}function resize_image($img_info){if($img_info["image_width"]<=0||$img_info["image_height"]<=0){return false;}if($img_info["random_file_name"]){$new_image_name=$img_info["unique_id"].get_extention($img_info);}else{$new_image_name=$img_info["image_data"]["name"];}$img_info["save_dir"]=$img_info["destination_folder"].$new_image_name;$new_width=200;$new_height=284;$img_info["canvas"]=imagecreatetruecolor($new_width,$new_height);if($img_info["image_type"]=='image/png'||$img_info["image_type"]=='image/gif'){imagecolortransparent($img_info["canvas"],imagecolorallocatealpha($img_info["canvas"],0,0,0,127));imagealphablending($img_info["canvas"],false);imagesavealpha($img_info["canvas"],true);}if(imagecopyresampled($img_info["canvas"],$img_info["img_res"],0,0,0,0,$new_width,$new_height,$img_info["image_width"],$img_info["image_height"])){if(save_image($img_info)){return $new_image_name;}}}function save_image($img_info){switch(strtolower($img_info["image_type"])){case 'image/png':imagepng($img_info["canvas"],$img_info["save_dir"]);break;case 'image/gif':imagegif($img_info["canvas"],$img_info["save_dir"]);break;case 'image/jpeg':case 'image/pjpeg':imagejpeg($img_info["canvas"],$img_info["save_dir"],$img_info["quality"]);break;default:return false;}imagedestroy($img_info["canvas"]);return true;}function get_image_resource($img_info){switch($img_info["image_type"]){case 'image/png':return imagecreatefrompng($img_info["image_data"]["tmp_name"]);case 'image/gif':return imagecreatefromgif($img_info["image_data"]["tmp_name"]);case 'image/jpeg':case 'image/pjpeg':return imagecreatefromjpeg($img_info["image_data"]["tmp_name"]);default:return false;}}function get_extention($img_info){switch($img_info["image_type"]){case 'image/gif':return ".gif";case 'image/jpeg':case 'image/pjpeg':return ".jpg";case 'image/png':return ".png";}}?>