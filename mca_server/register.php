<?php header('content-type: application/json; charset=utf-8');header('Access-Control-Allow-Origin: *');require_once('admin_mca/invedion_connect.php');$cn=idbc();$login=$cn->real_escape_string($_GET['login']);$pass=$cn->real_escape_string($_GET['pass']);$repass=$cn->real_escape_string($_GET['repass']);if($login&&$pass&&$repass){if(ereg('^[a-zA-Z0-9_\.\-]+@[a-zA-Z0-9\-]+\.[a-zA-Z0-9\-\.]+$',$login)){$question=$cn->query("SELECT * FROM mca_users WHERE mail = '$login'");if($question->num_rows>0){$json='{"mca":{"status":"user_exist"}}';echo $_GET['callback'].'('.$json.')';}else{if($pass==$repass){$today=date("Y-m-d");$question_register=$cn->query("INSERT INTO mca_users VALUES ('','$today', '$login', sha1('$pass'), '1')");if($question_register){$json='{"mca":{"status":"ok"}}';echo $_GET['callback'].'('.$json.')';}}else{$json='{"mca":{"status":"password"}}';echo $_GET['callback'].'('.$json.')';}}}else{$json='{"mca":{"status":"incorrect_mail"}}';echo $_GET['callback'].'('.$json.')';}}else{$json='{"mca":{"status":"fields"}}';echo $_GET['callback'].'('.$json.')';}?>